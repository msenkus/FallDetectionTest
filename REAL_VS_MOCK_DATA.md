# ğŸ­ Real vs Mock Data - Current System Status

## Overview
The system displays alerts from AltumView API, but some data is **mock/fake** because we can't decode the binary formats.

---

## ğŸ“Š Data Status Breakdown

### âœ… REAL Data (From AltumView API)

| Data | Source | Status |
|------|--------|--------|
| Alert ID | API | âœ… Real (`68f166168eeae9e50d48e58a`) |
| Alert Type | API | âœ… Real (`fall_detection`) |
| Timestamp | API | âœ… Real (`1760650774` = Dec 30, 2025) |
| Camera Serial | API | âœ… Real (`238071A4F37D31EE`) |
| Person Name | API | âœ… Real (`Someone`) |
| Room Name | API | âœ… Real (`Room 1`) |
| Camera Name | API | âœ… Real (`capstone`) |
| Is Resolved | API | âœ… Real (`true`) |
| Skeleton File | API | âœ… Real (6124 chars base64 binary) |
| Background URL | API | âœ… Real (S3 pre-signed URL) |

### âŒ MOCK Data (Generated by Our Backend)

| Data | Reason | Status |
|------|--------|--------|
| Skeleton Visualization | Binary format can't be decoded | âŒ FAKE |
| Keypoint Positions | Mock coordinates for demo | âŒ FAKE |
| Person Pose | Hardcoded fall position | âŒ FAKE |

---

## ğŸ¦´ Skeleton Data: Real vs Mock

### What's Actually Stored
```
Alert from API contains:
{
  "skeleton_file": "AwAAABZm8Wj+////NwAAAKQAXAA6ABcABQAvAAAAAAwzAQAAPQSPA..."  // âœ… REAL
}
```

This is **6124 characters of base64-encoded MQTT binary data**.

### The Problem
When decoded, it's **binary format** (not JSON):
```
00000000: 0300 0000 1666 f168 feff ffff 3700 0000  .....f.h....7...
00000010: a400 5c00 3a00 1700 0500 2f00 0000 000c  ..\.:...../.....
```

This is AltumView's proprietary skeleton format. We don't have the specification to decode it.

### Our Workaround
```java
// Backend returns MOCK skeleton data
private Map<String, Object> getMockSkeletonData() {
    // Hardcoded person in fall position
    person.add(Arrays.asList(250.0, 400.0)); // nose
    person.add(Arrays.asList(240.0, 395.0)); // left eye
    // ... 15 more keypoints
}
```

### What Frontend Displays
âŒ **FAKE skeleton** showing a person lying down (not the real person from the camera)

---

## ğŸ–¼ï¸ Background Image: Real but Expired

### What's Stored
```json
{
  "background_url": "https://cypress-prod-backgroundimage.s3.us-west-2.amazonaws.com/57087/19401/bg-token-2?AWSAccessKeyId=...&Expires=1761005142&Signature=..."
}
```

### The Issue: S3 URL Expiration
```
AWSAccessKeyId=AKIA5QWK3JBJI2AXEBF4
Expires=1761005142  â† Unix timestamp
Signature=F%2FSEp5FR4K9PQQEa6FCEicFlE7A%3D
```

**Expiration:** December 31, 2025 @ 3:05:42 AM UTC  
**Current Time:** October 20, 2025

The URL should still be valid, BUT:
- S3 bucket may have CORS restrictions
- URL might be region-locked
- Signature might be IP-specific

### Test the URL
```bash
# Check if URL is accessible
curl -I "https://cypress-prod-backgroundimage.s3.us-west-2.amazonaws.com/57087/19401/bg-token-2?AWSAccessKeyId=AKIA5QWK3JBJI2AXEBF4&Expires=1761005142&Signature=F%2FSEp5FR4K9PQQEa6FCEicFlE7A%3D"
```

**Current Result:** `403 Forbidden` âŒ

### Why 403 Error?
1. **CORS Policy** - S3 bucket doesn't allow browser access
2. **Signature Invalid** - IP address changed
3. **URL Expired Early** - Backend cached old URL
4. **Bucket Permissions** - Public access disabled

---

## ğŸ” What You're Actually Seeing

### Alert List Screen
```
âœ… REAL - Alert ID from AltumView
âœ… REAL - Timestamp of fall event  
âœ… REAL - Camera that detected it
```

### Alert Detail Screen
```
âœ… REAL - Alert metadata (ID, time, camera)
âŒ FAKE - Skeleton visualization (mock data)
âŒ BROKEN - Background image (403 error)
```

### Visual Representation
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Fall Detection Alert (REAL)         â”‚
â”‚  âœ… 2025-12-30 14:06:14 (REAL)          â”‚
â”‚  âœ… Camera: 238071A4F37D31EE (REAL)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚   âŒ Grey box (background image 403)   â”‚
â”‚                                         â”‚
â”‚        â— â† âŒ MOCK skeleton             â”‚
â”‚       â•±â”‚â•²    (hardcoded positions)     â”‚
â”‚      â— â”‚ â—                              â”‚
â”‚        â”‚                                â”‚
â”‚     â—â”€â”€â”¼â”€â”€â—                             â”‚
â”‚      â•² â”‚ â•±                              â”‚
â”‚       â•²â”‚â•±                               â”‚
â”‚        â—                                â”‚
â”‚                                         â”‚
â”‚   Not the real person from the camera!  â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ How to Get REAL Data

### Option 1: Get AltumView Binary Protocol Spec
Contact AltumView support and request:
1. **Skeleton binary format specification**
2. **Coordinate encoding details** (int16? float32?)
3. **Frame structure documentation**

Then implement proper decoder:
```java
public Map<String, Object> decodeRealSkeleton(byte[] binaryData) {
    // Parse according to AltumView spec
    // Return actual keypoint coordinates
}
```

### Option 2: Use MQTT Live Stream
Subscribe to skeleton MQTT topic and capture real-time data:
```
Topic: mobileClient/{groupId}/camera/{serial}/skeleton/{token}
```

This would give you:
- âœ… Real skeleton data in same binary format
- âœ… Live visualization
- âœ… Working examples to reverse-engineer

### Option 3: Request Background Image Refresh
Add backend endpoint that fetches fresh S3 URL:
```java
@GetMapping("/alerts/{alertId}/background/refresh")
public String refreshBackgroundUrl(String alertId) {
    // Call AltumView API to get new signed URL
    // Return fresh URL with new expiration
}
```

---

## ğŸ“‹ Current Capabilities

### What Works âœ…
- Loading alerts from AltumView API
- Displaying alert metadata (all real)
- Skeleton visualization system (architecture works)
- Background image system (architecture works)

### What's Limited âš ï¸
- Skeleton shows mock data (not real person)
- Background image fails to load (URL issues)
- Can't decode real binary skeleton data

### What Doesn't Work âŒ
- Real skeleton visualization
- Reliable background image display
- Video playback (not implemented)

---

## ğŸ¯ Quick Verification

### Check What's Real
```bash
# Get alert data
curl http://localhost:8080/api/skeleton/alerts/68f166168eeae9e50d48e58a | jq '{
  id,
  alert_type,
  created_at,
  camera_serial_number,
  person_name,
  room_name,
  has_skeleton: (.skeleton_file != null),
  skeleton_length: (.skeleton_file | length),
  background_url
}'
```

**Everything except skeleton visualization is REAL** âœ…

### Check Mock Skeleton
```bash
# Get mock skeleton data
curl http://localhost:8080/api/skeleton/alerts/68f166168eeae9e50d48e58a/skeleton-decoded | jq '.people[0] | length'
```

**Returns:** `17` (hardcoded mock keypoints) âŒ

---

## ğŸ’¡ Recommendations

### Immediate Actions
1. **Add Warning Banner** - Show users that skeleton is mock data
2. **Fix Background Image** - Proxy through backend to avoid CORS
3. **Add Data Source Labels** - Mark what's real vs mock

### Short Term
1. **Contact AltumView** - Request binary protocol spec
2. **Implement MQTT** - Subscribe to live skeleton stream
3. **Background Refresh** - Add endpoint to get fresh S3 URLs

### Long Term
1. **Real Skeleton Decoder** - Parse actual binary data
2. **Video Playback** - Add video player for alerts
3. **Live Monitoring** - Real-time skeleton visualization

---

## ğŸ“ Summary

| Component | Status | Notes |
|-----------|--------|-------|
| Alert Metadata | âœ… Real | All info from AltumView API |
| Skeleton Binary | âœ… Real | Stored but can't decode |
| Skeleton Visualization | âŒ Mock | Hardcoded demo data |
| Background URL | âœ… Real | Valid S3 URL |
| Background Image | âŒ Broken | 403 Forbidden error |
| Video Clips | âŒ Missing | Not implemented |

**Bottom Line:** The system architecture is solid and data is coming from AltumView API, but we're using mock skeleton visualization because the real data is in an undocumented binary format.

---

**Last Updated:** October 20, 2025  
**Status:** Functional with Mock Data  
**Next Step:** Get AltumView binary protocol specification
