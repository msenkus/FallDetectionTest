# 🎭 Real vs Mock Data - Current System Status

## Overview
The system displays alerts from AltumView API, but some data is **mock/fake** because we can't decode the binary formats.

---

## 📊 Data Status Breakdown

### ✅ REAL Data (From AltumView API)

| Data | Source | Status |
|------|--------|--------|
| Alert ID | API | ✅ Real (`68f166168eeae9e50d48e58a`) |
| Alert Type | API | ✅ Real (`fall_detection`) |
| Timestamp | API | ✅ Real (`1760650774` = Dec 30, 2025) |
| Camera Serial | API | ✅ Real (`238071A4F37D31EE`) |
| Person Name | API | ✅ Real (`Someone`) |
| Room Name | API | ✅ Real (`Room 1`) |
| Camera Name | API | ✅ Real (`capstone`) |
| Is Resolved | API | ✅ Real (`true`) |
| Skeleton File | API | ✅ Real (6124 chars base64 binary) |
| Background URL | API | ✅ Real (S3 pre-signed URL) |

### ❌ MOCK Data (Generated by Our Backend)

| Data | Reason | Status |
|------|--------|--------|
| Skeleton Visualization | Binary format can't be decoded | ❌ FAKE |
| Keypoint Positions | Mock coordinates for demo | ❌ FAKE |
| Person Pose | Hardcoded fall position | ❌ FAKE |

---

## 🦴 Skeleton Data: Real vs Mock

### What's Actually Stored
```
Alert from API contains:
{
  "skeleton_file": "AwAAABZm8Wj+////NwAAAKQAXAA6ABcABQAvAAAAAAwzAQAAPQSPA..."  // ✅ REAL
}
```

This is **6124 characters of base64-encoded MQTT binary data**.

### The Problem
When decoded, it's **binary format** (not JSON):
```
00000000: 0300 0000 1666 f168 feff ffff 3700 0000  .....f.h....7...
00000010: a400 5c00 3a00 1700 0500 2f00 0000 000c  ..\.:...../.....
```

This is AltumView's proprietary skeleton format. We don't have the specification to decode it.

### Our Workaround
```java
// Backend returns MOCK skeleton data
private Map<String, Object> getMockSkeletonData() {
    // Hardcoded person in fall position
    person.add(Arrays.asList(250.0, 400.0)); // nose
    person.add(Arrays.asList(240.0, 395.0)); // left eye
    // ... 15 more keypoints
}
```

### What Frontend Displays
❌ **FAKE skeleton** showing a person lying down (not the real person from the camera)

---

## 🖼️ Background Image: Real but Expired

### What's Stored
```json
{
  "background_url": "https://cypress-prod-backgroundimage.s3.us-west-2.amazonaws.com/57087/19401/bg-token-2?AWSAccessKeyId=...&Expires=1761005142&Signature=..."
}
```

### The Issue: S3 URL Expiration
```
AWSAccessKeyId=AKIA5QWK3JBJI2AXEBF4
Expires=1761005142  ← Unix timestamp
Signature=F%2FSEp5FR4K9PQQEa6FCEicFlE7A%3D
```

**Expiration:** December 31, 2025 @ 3:05:42 AM UTC  
**Current Time:** October 20, 2025

The URL should still be valid, BUT:
- S3 bucket may have CORS restrictions
- URL might be region-locked
- Signature might be IP-specific

### Test the URL
```bash
# Check if URL is accessible
curl -I "https://cypress-prod-backgroundimage.s3.us-west-2.amazonaws.com/57087/19401/bg-token-2?AWSAccessKeyId=AKIA5QWK3JBJI2AXEBF4&Expires=1761005142&Signature=F%2FSEp5FR4K9PQQEa6FCEicFlE7A%3D"
```

**Current Result:** `403 Forbidden` ❌

### Why 403 Error?
1. **CORS Policy** - S3 bucket doesn't allow browser access
2. **Signature Invalid** - IP address changed
3. **URL Expired Early** - Backend cached old URL
4. **Bucket Permissions** - Public access disabled

---

## 🔍 What You're Actually Seeing

### Alert List Screen
```
✅ REAL - Alert ID from AltumView
✅ REAL - Timestamp of fall event  
✅ REAL - Camera that detected it
```

### Alert Detail Screen
```
✅ REAL - Alert metadata (ID, time, camera)
❌ FAKE - Skeleton visualization (mock data)
❌ BROKEN - Background image (403 error)
```

### Visual Representation
```
┌─────────────────────────────────────────┐
│  ✅ Fall Detection Alert (REAL)         │
│  ✅ 2025-12-30 14:06:14 (REAL)          │
│  ✅ Camera: 238071A4F37D31EE (REAL)     │
├─────────────────────────────────────────┤
│                                         │
│   ❌ Grey box (background image 403)   │
│                                         │
│        ● ← ❌ MOCK skeleton             │
│       ╱│╲    (hardcoded positions)     │
│      ● │ ●                              │
│        │                                │
│     ●──┼──●                             │
│      ╲ │ ╱                              │
│       ╲│╱                               │
│        ●                                │
│                                         │
│   Not the real person from the camera!  │
│                                         │
└─────────────────────────────────────────┘
```

---

## 🛠️ How to Get REAL Data

### Option 1: Get AltumView Binary Protocol Spec
Contact AltumView support and request:
1. **Skeleton binary format specification**
2. **Coordinate encoding details** (int16? float32?)
3. **Frame structure documentation**

Then implement proper decoder:
```java
public Map<String, Object> decodeRealSkeleton(byte[] binaryData) {
    // Parse according to AltumView spec
    // Return actual keypoint coordinates
}
```

### Option 2: Use MQTT Live Stream
Subscribe to skeleton MQTT topic and capture real-time data:
```
Topic: mobileClient/{groupId}/camera/{serial}/skeleton/{token}
```

This would give you:
- ✅ Real skeleton data in same binary format
- ✅ Live visualization
- ✅ Working examples to reverse-engineer

### Option 3: Request Background Image Refresh
Add backend endpoint that fetches fresh S3 URL:
```java
@GetMapping("/alerts/{alertId}/background/refresh")
public String refreshBackgroundUrl(String alertId) {
    // Call AltumView API to get new signed URL
    // Return fresh URL with new expiration
}
```

---

## 📋 Current Capabilities

### What Works ✅
- Loading alerts from AltumView API
- Displaying alert metadata (all real)
- Skeleton visualization system (architecture works)
- Background image system (architecture works)

### What's Limited ⚠️
- Skeleton shows mock data (not real person)
- Background image fails to load (URL issues)
- Can't decode real binary skeleton data

### What Doesn't Work ❌
- Real skeleton visualization
- Reliable background image display
- Video playback (not implemented)

---

## 🎯 Quick Verification

### Check What's Real
```bash
# Get alert data
curl http://localhost:8080/api/skeleton/alerts/68f166168eeae9e50d48e58a | jq '{
  id,
  alert_type,
  created_at,
  camera_serial_number,
  person_name,
  room_name,
  has_skeleton: (.skeleton_file != null),
  skeleton_length: (.skeleton_file | length),
  background_url
}'
```

**Everything except skeleton visualization is REAL** ✅

### Check Mock Skeleton
```bash
# Get mock skeleton data
curl http://localhost:8080/api/skeleton/alerts/68f166168eeae9e50d48e58a/skeleton-decoded | jq '.people[0] | length'
```

**Returns:** `17` (hardcoded mock keypoints) ❌

---

## 💡 Recommendations

### Immediate Actions
1. **Add Warning Banner** - Show users that skeleton is mock data
2. **Fix Background Image** - Proxy through backend to avoid CORS
3. **Add Data Source Labels** - Mark what's real vs mock

### Short Term
1. **Contact AltumView** - Request binary protocol spec
2. **Implement MQTT** - Subscribe to live skeleton stream
3. **Background Refresh** - Add endpoint to get fresh S3 URLs

### Long Term
1. **Real Skeleton Decoder** - Parse actual binary data
2. **Video Playback** - Add video player for alerts
3. **Live Monitoring** - Real-time skeleton visualization

---

## 📝 Summary

| Component | Status | Notes |
|-----------|--------|-------|
| Alert Metadata | ✅ Real | All info from AltumView API |
| Skeleton Binary | ✅ Real | Stored but can't decode |
| Skeleton Visualization | ❌ Mock | Hardcoded demo data |
| Background URL | ✅ Real | Valid S3 URL |
| Background Image | ❌ Broken | 403 Forbidden error |
| Video Clips | ❌ Missing | Not implemented |

**Bottom Line:** The system architecture is solid and data is coming from AltumView API, but we're using mock skeleton visualization because the real data is in an undocumented binary format.

---

**Last Updated:** October 20, 2025  
**Status:** Functional with Mock Data  
**Next Step:** Get AltumView binary protocol specification
